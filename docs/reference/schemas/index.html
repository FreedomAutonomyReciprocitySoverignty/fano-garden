<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Schemas | fano-garden</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@500;600;700&family=Source+Serif+4:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../../assets/site/styles.css" />
    <script defer src="../../assets/site/base-path.js"></script>
  </head>
  <body>
    <main class="site">
      <nav class="nav">
        <a data-nav-path="/">Home</a>
        <a data-nav-path="/quickstart/">Quickstart</a>
        <a data-nav-path="/demo/">Live Demo</a>
        <a data-nav-path="/reference/">Reference</a>
      </nav>
      <article class="doc">
        <h1>NDJSON Schemas (browser-v1)</h1>
        <p>Frozen schema definitions and canonicalization constraints for interchange.</p>

        <h2>Canonicalization for Hash/Signature</h2>
        <ol>
          <li>UTF-8 JSON with sorted object keys.</li>
          <li>No insignificant whitespace.</li>
          <li>Exclude transport envelope fields.</li>
          <li>Hash algorithm: <code>sha256</code>.</li>
        </ol>

        <h2>CommitEvent Required Fields</h2>
        <pre><code>{
  "id": "string",
  "t": "unix_ms",
  "type": "vertex_init|edge_update|face_eval|commit|projection|sync",
  "parents": ["id"],
  "vertex": "object|null",
  "edges": [],
  "faces": [],
  "centroid": {},
  "status": "pending|validated|sealed|quarantined",
  "prev_hash": "string|null",
  "self_hash": "string",
  "sig": "string",
  "lc": "optional integer >=0"
}</code></pre>

        <h2>Validation Rules</h2>
        <ul>
          <li>Unknown top-level fields are allowed and ignored for validity.</li>
          <li>Missing required fields invalidate record -> quarantine.</li>
          <li><code>stop_metric</code> and <code>closure_ratio</code> must be in <code>[0,1]</code>.</li>
          <li><code>sabbath=true</code> requires both metrics equal <code>1.0</code>.</li>
          <li><code>self_hash</code> mismatch invalidates record.</li>
        </ul>

        <h2>Interop</h2>
        <ul>
          <li>One JSON object per line.</li>
          <li>Consumers tolerate extra fields.</li>
          <li>Replay state must be reconstructable from NDJSON alone.</li>
        </ul>

        <p>Full source: <a href="https://github.com/FreedomAutonomyReciprocitySoverignty/fano-garden/blob/main/dev-docs/reference-implementation-schemas.ndjson.md">dev-docs/reference-implementation-schemas.ndjson.md</a></p>
      </article>
    </main>
  </body>
</html>
